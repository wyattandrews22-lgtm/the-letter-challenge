<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Letter Challenge</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    background: #121213;
    color: #fff;
    margin: 0;
    padding: 0;
  }
  h1 {
    margin: 20px 0;
    color: #f3ba2f;
    text-shadow: 2px 2px #000;
  }
  .letters {
    display: flex;
    justify-content: center;
    margin: 15px 0;
    flex-wrap: wrap;
    max-width: 500px;
  }
  .letter {
    border: 2px solid #3a3a3c;
    border-radius: 6px;
    padding: 12px;
    margin: 4px;
    font-size: 20px;
    width: 45px;
    text-align: center;
    cursor: pointer;
    user-select: none;
    background: #818384;
    color: #fff;
    font-weight: bold;
    transition: all 0.2s ease;
  }
  .letter:hover {
    background: #ffb74d;
    transform: scale(1.1);
    color: #000;
  }
  #wordInput {
    font-size: 22px;
    padding: 10px;
    width: 260px;
    text-align: center;
    border: 2px solid #3a3a3c;
    border-radius: 6px;
    background: #1e1e1e;
    color: #fff;
    margin-top: 10px;
    pointer-events: none;
  }
  .word-list {
    margin-top: 20px;
    width: 100%;
    max-width: 320px;
    max-height: 200px;
    overflow-y: auto;
  }
  .word {
    padding: 5px;
    border-bottom: 1px solid #3a3a3c;
  }
  .score {
    margin-top: 20px;
    font-size: 24px;
    font-weight: bold;
    color: #4caf50;
    text-shadow: 1px 1px #000;
  }
  button {
    padding: 12px 20px;
    margin: 8px;
    font-size: 20px;
    border-radius: 6px;
    border: none;
    background: #538d4e;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s ease;
  }
  button:hover {
    background: #81c784;
  }
  .timer {
    font-size: 24px;
    margin-top: 15px;
    font-weight: bold;
    color: #f44336;
    text-shadow: 1px 1px #000;
  }
  #gameOverScreen {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.9);
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    z-index: 10;
  }
  #gameOverScreen button {
    margin-top: 20px;
  }
  #startScreen {
    margin-top: 100px;
    text-align: center;
  }
</style>
</head>
<body>

<h1>The Letter Challenge</h1>

<div id="gameArea" style="display:none;">
  <div class="letters" id="letters"></div>
  <input type="text" id="wordInput" readonly>
  <div>
    <button onclick="submitWord()">‚úîÔ∏è Submit</button>
    <button onclick="undoLetter()">‚Ü©Ô∏è Undo</button>
  </div>
  <div class="timer" id="timer">‚è≥ 60</div>
  <div class="score" id="score">Score: 0</div>
  <div class="word-list" id="wordList"></div>
</div>

<div id="startScreen">
  <p>Loading dictionary...</p>
</div>

<div id="gameOverScreen">
  <div id="finalScore"></div>
  <button onclick="restartGame()">üîÑ Play Again</button>
</div>

<script>
let dictionary = [];
let letters = [];
let currentWord = [];
let foundWords = new Set();
let score = 0;
let timer, timeLeft = 60;
let currentMode = "basic";

const lettersDiv = document.getElementById("letters");
const wordInput = document.getElementById("wordInput");
const wordListDiv = document.getElementById("wordList");
const scoreDisplay = document.getElementById("score");
const timerDisplay = document.getElementById("timer");

// Load dictionary dynamically
fetch("words.txt")
  .then(response => response.text())
  .then(text => {
    dictionary = text.split("\n").map(w => w.trim().toLowerCase()).filter(w => w.length > 0);
    document.getElementById("startScreen").innerHTML = `
      <h2>Choose a Mode</h2>
      <button onclick="startGame('basic')">‚ñ∂Ô∏è Basic Mode</button>
      <button onclick="startGame('terrible')">üíÄ Terrible Tens</button>
    `;
  });

function shuffleArray(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
  return array;
}

// Pick letters that guarantee at least 3 valid words
function pickValidSet(size) {
  let chosenSet = "";
  let validWords = [];
  
  while(true) {
    const candidate = shuffleArray("ABCDEFGHIJKLMNOPQRSTUVWXYZ".split('')).slice(0,size).join('');
    validWords = dictionary.filter(word => 
      word.split('').every(l => candidate.includes(l.toUpperCase()))
    );
    if(validWords.length >= 3) { 
      chosenSet = candidate; 
      break; 
    }
  }
  return chosenSet;
}

function displayLetters(arr){
  lettersDiv.innerHTML="";
  arr.forEach(l=>{
    const div=document.createElement("div");
    div.classList.add("letter");
    div.textContent=l;
    div.onclick=()=>{ currentWord.push(l); renderCurrentWord(); };
    lettersDiv.appendChild(div);
  });
}

function renderCurrentWord(){
  wordInput.value=currentWord.join('');
}

function undoLetter(){
  currentWord.pop();
  renderCurrentWord();
}

function submitWord(){
  const word=currentWord.join('').toLowerCase();
  if(timeLeft<=0) return;
  if(word.length>=2 && dictionary.includes(word) && !foundWords.has(word)){
    if([...word].every(l=>letters.includes(l.toUpperCase()))){
      foundWords.add(word);
      const wordDiv=document.createElement("div");
      wordDiv.classList.add("word");
      wordDiv.textContent=word;
      wordListDiv.appendChild(wordDiv);
      score+=word.length;
      scoreDisplay.textContent="Score: "+score;
    }
  }
  currentWord=[];
  renderCurrentWord();
}

function startGame(mode){
  currentMode = mode;
  document.getElementById("startScreen").style.display="none";
  document.getElementById("gameArea").style.display="block";
  score=0; foundWords.clear(); wordListDiv.innerHTML=""; scoreDisplay.textContent="Score: 0"; timeLeft=60;
  let size = (mode === "basic") ? 5 : 10;
  letters=shuffleArray(pickValidSet(size).split(''));
  displayLetters(letters);
  timerDisplay.textContent="‚è≥ "+timeLeft;
  timer=setInterval(()=>{
    timeLeft--;
    timerDisplay.textContent="‚è≥ "+timeLeft;
    if(timeLeft<=0){ clearInterval(timer); showGameOver(); }
  },1000);
}

function showGameOver(){
  document.getElementById("gameOverScreen").style.display="flex";
  document.getElementById("finalScore").textContent="Game Over! Final Score: "+score;
}

function restartGame(){
  document.getElementById("gameOverScreen").style.display="none";
  document.getElementById("startScreen").style.display="block";
  document.getElementById("startScreen").innerHTML = `
    <h2>Choose a Mode</h2>
    <button onclick="startGame('basic')">‚ñ∂Ô∏è Basic Mode</button>
    <button onclick="startGame('terrible')">üíÄ Terrible Tens</button>
  `;
}
</script>
</body>
</html>
